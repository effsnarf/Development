dom:
  div: 
    class: box2
    h3:
      ui.title:
        ':icon': icon
        ':text': compName
        ':number': title
    ui.console:
      v-show: 'false'
      ref: console1
    div: 
      slot: null
props:
  icon: null
  title: null
mounted: | #js
  function() {
    // We want to know what the module is sending out
    const emit = this.$parent.$emit.bind(this.$parent);
    this.$parent.$emit = async (emitName, ...args) => {
      await this.$parent.$nextTick();
      this.$refs.console1.log("âž•", emitName);
      this.$root.$emit("flow.event", this.compName, emitName, args);
    };

    this.$root.$on("flow.event", this.onFlowEvent);
  }
methods:
  onFlowEvent: | #js
    async function(compName, emitName, args) {
      if (["ui.mouse"].includes(compName)) return;

      const vue = this.$parent;

      if (emitName == "to")
      {
        const to = {
          compName: args[0],
          fuid: args[1],
          methodName: args[2],
          args: args[3],
        };
        
        if (to.compName != vue.$data._.comp.name) return;
        if (to.fuid != vue.fuid) return;

        const method = vue[to.methodName];
        if (!method) throw new Error(`Method not found: ${to.methodName}`);
        
        //console.log("ðŸ”´", to.compName, "ðŸš€", vue.$data._.comp.name, to.methodName, to.args)
        await (method.bind(vue))(...(to.args||[]));

        return;
      }

      if (vue.onAllEvents) {
        //console.log("ðŸ”´", vue.$data._.comp.name, "onAllEvents", "ðŸš€", compName, emitName, args)
        vue.onAllEvents(compName, emitName, args);
      }
      const methodName = `${compName}_${emitName}`.replace(/\./g, "_");
      const method = vue[methodName];
      if (!method) return;
      console.log("ðŸ”´", compName, "ðŸš€", vue.$data._.comp.name, emitName, args);
      (method.bind(vue))(...args);
    }
  onAllEvents: | #js
    function(compName, emitName, args) {
      const methodName = `${compName}_${emitName}`.replace(/\./g, "_");
      if (this.$parent[methodName]) {
        // Module caught an event
        this.$refs.console1.log("âž–", compName, emitName);
      }
    }
computed:
  compName: | #js
    function() {
      return this.$parent?.$data?._?.comp?.name;
    }
style:
  h3:
    font-weight: normal
  .box2:
    margin: 1em
    border: '1px dashed #ccc'
  .box2 > *:
    margin-left: 1em
_:
  examples:
    count: 0
name: flow-module
template: >-
  <div class="comp-flow-module box2" path="924662572."><h3
  path="924662572.0"><ui-title :icon="icon" :text="compName" :number="title"
  path="924662572.0.0"></ui-title></h3><ui-console v-show="false" ref="console1"
  path="924662572.1"></ui-console><div
  path="924662572.2"><slot></slot></div></div>
