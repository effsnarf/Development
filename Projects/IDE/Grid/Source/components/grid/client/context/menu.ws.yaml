dom:
  ui.context.window:
    ref: context1
    ':visible': showContextMenu
    @pinned: contextIsPinned = $event
    grid.client.context.create.group:
      ':selected-boxes': selectedBoxes
      ':userID': userID
      ':boxes': $root.boxes
      ':links': $root.links
      ':context-is-pinned': contextIsPinned
    div:
      v-if: canDelete
      ui.button:
        icon: ❌🗑️
        text: delete
        confirm: Are you sure you want to delete the selected boxes?
        @click: getUiActions().$femit('delete.selected')
props:
  userID: null
data:
  selectedBoxes: []
  showContextMenu: false
  canDelete: false
  contextIsPinned: false
mounted: | #js
  function() {
    // We're binding manually instead of using grid.module because we can't put the context menu inside the grid.module
    this.$root.$on("grid.event", this.onGridEvent.bind(this));
  }
methods:
  onGridEvent: | #js
    function(compName, eventName, args) {
      if (["mouse.pos"].includes(eventName)) return;
      const methodName = `${compName}.${eventName}`.replace(/\./g, "_");
      const method = this[methodName]?.bind(this);
      if (method) method(...args);
    }
  grid_user_action_stack_do: | #js
    async function(action) {
      if (!["select.boxes"].some(s => action.redo.method.includes(s))) return;
      this.refresh();
    }
  refresh: | #js
    async function(times = 10) {
      const self = this;
      await self._refresh();
      if (times > 0) setTimeout(() => self.refresh(times - 1), 400);
    }
  _refresh: | #js
    async function() {
      const { boxes, links } = this.$root;
      this.selectedBoxes = boxes.filter(box => box.is?.selected);
      this.canDelete = (this.selectedBoxes.length > 0);
      this.showContextMenu = (this.canCreateGroup || this.canDelete);
    }
  getUiActions: | #js
    function() {
      return this.$parent.$parent.getUiActions();
    }
watch:
  boxes:
    handler: | #js
      async function() {
        await this.$nextTick();
        this.refresh();
      }
    immediate: true
style: null
_:
  examples:
    count: 0
name: grid-client-context-menu
template: >-
  <ui-context-window class="comp-grid-client-context-menu" ref="context1"
  :visible="showContextMenu" @pinned="contextIsPinned = $event"
  path="-1053034279."><grid-client-context-create-group
  :selected-boxes="selectedBoxes" :userID="userID" :boxes="$root.boxes"
  :links="$root.links" :context-is-pinned="contextIsPinned"
  path="-1053034279.0"></grid-client-context-create-group><div v-if="canDelete"
  path="-1053034279.1"><ui-button icon="❌🗑️" text="delete" confirm="Are you
  sure you want to delete the selected boxes?"
  @click="getUiActions().$femit('delete.selected')"
  path="-1053034279.1.0"></ui-button></div></ui-context-window>
