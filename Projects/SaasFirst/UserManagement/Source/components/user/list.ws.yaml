dom:
  div:
    h3:
      class: top-bar
      .flex1:
        div:
          transition:
            name: slide-hor
            button:
              v-if: canDeleteSelectedUsers
              v-text: "'üóëÔ∏è delete selected users'"
              @click: onClickDeleteSelectedUsers
        div:
          transition:
            name: slide-hor
            div:
              v-if: selectedUsers.length
              class: text-center
              v-text: "selectedUsers.length + ' users selected'"
        div:
          button:
            v-text: "'+ Add new user'"
            :class: "{ disabled: !isAddUserEnabled }"
            @click: onClickAddUser
    .header.row:
      .check:
        input:
          type: checkbox
          @click: onClickSelectAll
      .icon:
        h3:
          v-text: "'Users'"
      .name-column:
        v-text: "'-'"
      .permission:
        h3:
          v-text: "'Permission'"
      .buttons:
        v-text: "'-'"
    transition.group:
      name: slide
      class: rows
      user.item:
        v-for: user in getPageUsers(pageIndex)
        :key: user.id
        :user: user
        :newEmptyUserID: newEmptyUserID
        @save: onSaveUser
        @delete: onClickDeleteUser
    div:
      ui.pager:
        :items-count: users.length
        :page-size: pageSize
        v-model: pageIndex

data:
  users: []
  pageIndex: 0
  pageSize: 6
  newEmptyUserID: -1

mounted: | #js
  function() {
    const initialUsersCount = 10;

    for (let i = 0; i < initialUsersCount; i++) {
      const user = {
        id: (i+1),
        name: `Tam√°s Szab√≥ ${i+1}`,
        email: `Email ${i+1}`,
        permission: {
          id: ((i % 2)),
        },
        color: {
          id: ((i % 3) + 1),
        },
        ui: {
          is: {
            selected: false,
            editing: false,
          },
          edited: {
            name: null,
            email: null,
          }
        }
      };
      user.ui.edited.name = user.name;
      user.ui.edited.email = user.email;
      this.users.push(user);
    }
  }

methods:
  onClickAddUser: | #js
    function() {
      const user = this.getNewUser();
      user.ui.is.editing = true;
      this.users.push(user);
    }
  onClickSelectAll: | #js
    function() {
      const selectAllValue = !this.users.every(u => u.ui.is.selected);
      this.users.forEach(u => u.ui.is.selected = selectAllValue);
    }
  onClickDeleteSelectedUsers: | #js
    function() {
      if (this.selectedUsers.length == 1) {
        this.onClickDeleteUser(this.selectedUsers[0]);
        return;
      }
      alertify.confirm(`Delete ${this.selectedUsers.length} users?`, () => {
        this.deleteSelectedUsers();
      });
    }
  deleteSelectedUsers: | #js
    function() {
      this.selectedUsers.forEach(this.deleteUser.bind(this));
    }
  onSaveUser: | #js
    function(user) {
      user.id = this.getNewUserID();
    }
  onClickDeleteUser: | #js
    function(user) {
      if (user.ui.is.editing && this.userIsEmpty(user)) {
        this.deleteUser(user);
        return;
      }
      alertify.confirm(`Delete ${user.name}?`, () => {
        this.deleteUser(user);
      });
    }
  deleteUser: | #js
    function(user) {
      const index = this.users.findIndex(u => u.id == user.id);
      this.users.splice(index, 1);
    }
  getNewUser: | #js
    function() {
      return {
        id: this.newEmptyUserID,
        name: ``,
        email: ``,
        permission: ``,
        color: {
          id: 0,
        },
        ui: {
          is: {
            selected: false,
            editing: false,
          },
          edited: {
            name: null,
            email: null,
          }
        }
      };
    }
  getNewUserID: | #js
    function() {
      return (this.users.length + 1);
    }
  getPageUsers: | #js
    function(pageIndex) {
      const start = (pageIndex * this.pageSize);
      return [...this.users]
        .sortBy(u => u.id)
        .slice(start, start + this.pageSize);
    }
  userIsEmpty: | #js
    function(user) {
      return !user.name.length && !user.email.length;
    }

computed:
  selectedUsers: | #js
    function() {
      return this.users.filter(u => u.ui.is.selected)
    }
  canDeleteSelectedUsers: | #js
    function() {
      if (!this.selectedUsers.length) return false;
      // If the only selected user is a new user, delete all button is disabled
      if (this.selectedUsers.length == 1 && this.selectedUsers[0].id == this.newEmptyUserID) return false;
      return true;
    }
  isAddUserEnabled: | #js
    function() {
      if (this.users.some(u => u.ui.is.editing)) return false;
      return true;
    }


style:
  .top-bar:
    margin: 1em
    white-space: nowrap
  .top-bar button:
    padding: 0.8em 1em !important
  .rows:
    display: flex
    flex-direction: column
    gap: 1px
  .flex1:
    display: flex
    align-items: center
    justify-content: space-around
  .header.row:
    opacity: 0.7
  .row:
    display: flex
    justify-content: space-between
    align-items: center
    gap: 1em
    border: "1px solid transparent"
  .rows .row:
    margin: 0.5rem
    cursor: pointer
  .rows .row:hover:
    border: "1px solid #00000040"
    transition: 0s
  .row:hover .buttons:
    opacity: 1
  .check:
    flex-shrink: 1
  .icon:
    width: 4em
    flex-shrink: 1
  .name-column:
    flex-grow: 1
  .permission:
    width: 10em
  .circle:
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%
    aspect-ratio: 1
    font-size: 1.5em
    border-radius: 50%
    color: white;
  .buttons:
    display: flex
    align-items: center
    width: 14em
    gap: 0.5em
    opacity: 0
  h3 button:
    padding: 0.5em 1.2em !important
  input[type=text]:
    opacity: 1 !important
