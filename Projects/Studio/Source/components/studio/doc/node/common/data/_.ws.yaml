dom:
  div:
    v-if: node
    .warning:
      v-if: (('list' == node.type) && (nodeDatas?.items) && !Array.isArray(nodeDatas?.items))
      v-text: "'Data in a list component must be an array.'"
    .warning:
      v-if: (nodeDatas?._items && !Array.isArray(nodeDatas?.items))
      v-text: "'Use the 🛠️ linq control to select the array from the data.'"
    div:
      v-for: varPath in Object.keys(nodeDatas)
      .flex1:
        h3:
          v-text: "'🧊 ' + varPath.split('.').last()"
        .folded.em2:
          ui.value:
            :value: nodeDatas[varPath]
      div:
        v-if: "varPath.endsWith('._items')"
        .flex1:
          h3:
            v-text: "'🛠️ linq'"
          .folded.em2:
            pre:
              v-text: node.data?.source?.linq
            ui.linq:
              v-if: (false && nodeDatas?.[varPath] && node.data?.source?.linq)
              :input: nodeDatas[varPath]
              v-model: node.data.source.linq
              @output: onLinqOutput
    div:
      v-if: itemsVarPath
      h2:
        v-text: "'🧊 items'"
      ui.value:
        :value: Objects.getProperty(userAppState, itemsVarPath)

props:
  node:
  userAppState:

data:
  linqOutputData:

methods:
  onLinqOutput: | #js
    function(newValue) {
      const varPath = this.nodeVarPaths.find(v => (v.endsWith("._items")));
      const oldValue = Objects.getProperty(this.userAppState, varPath);
      this.$root.studio.user.app.state.set(varPath, newValue);
    }

computed:
  nodeDatas: | #js
    function() {
      return this.nodeVarPaths.reduce((obj, p, i) => {
        obj[p] = Objects.getProperty(this.userAppState, p);
        return obj;
      }, {});
    }
  nodeVarPaths: | #js
    function() {
      const varPaths = [];
      const varPath = this.varPath;
      if (!varPath) return varPaths;

      if ("list" == this.node.type) {
        varPaths.push(`${varPath}._items`);
      }
      else {
        varPaths.push(varPath);
      }
      return varPaths;
    }
  itemsVarPath: | #js
    function() {
      if ("list" == this.node.type) {
        return `${this.varPath}.items`;
      }
      return null;
    }
  varPath: | #js
    function() {
      return this.$root.getNodeVarPath(this.node);
    }
  Objects: | #js
    function() {
      return window.Objects;
    }

style:
  h3:
    opacity: 0.7
  .flex1:
    display: flex
  .flex1 > *:hover:
    background: "#80808040"
  .flex1 > *:nth-child(1):
    width: 7em
  .flex1 > *:nth-child(2):
    width: calc(100% - 7em)
    opacity: 0.3
  .flex1:hover > *:nth-child(2):
    filter: none
    opacity: 1
  .warning:
    margin: 1em