dom:
  div:
    div:
      h2:
        ui.input.text.box:
          icon: 📦🧊
          camouflage: true
          v-model: node.name
    div:
      v-if: node?.vars
      .flex:
        ui.drawer:
          ui.select:
            :options: visibleNodeVars
            :get-item-icon: (v) => '🧊'
            :get-item-text: (v) => v.name
            v-model: selectedNodeVarIndex
        .flex-grow-1:
          div:
            v-for: (var1, i) in visibleNodeVars
            transition:
              name: slide-ver
              div:
                v-if: (i == selectedNodeVarIndex)
                h3:
                  ui.input.text.box:
                    icon: 🧊
                    camouflage: true
                    v-model: var1.name
                ui.tabs:
                  :options: tabOptions
                  direction: vertical
                  :drawer: "true"
                  :show-title-in-tab: "true"
                  :value: null
                  @input: (newTab) => onTabChange(var1, newTab)
                  template:
                    v-slot: tab0
                    studio.doc.node.common.data.editor.field:
                      :node-var: var1
                      :initial: initial
                      :sui: sui
                  template:
                    v-slot: tab1
                    ui.input.text.box:
                      hint: expression
                      :multiline: "true"
                      :auto-resize: "true"
                      v-model: var1.exp
                  template:
                    v-slot: tab2
                    studio.doc.node.common.data.editor.fetch:
                      :node: node
                      :node-var: var1
                      :node-var-path: getNodeVarPath(var1)
                  template:
                    v-slot: tab3
                    studio.doc.node.common.data.editor.node.prop:
                      :node-var: var1
                  template:
                    v-slot: tab4
                    studio.doc.node.common.data.editor.value:
                      :node-var: var1

props:
  node:
  initial:
  userApp:
  userAppState:
  sui:

data:
  tabOptions: ['🍃 field', '🟰 exp', '🌐 fetch', '🔗 node.prop', '🧊 value']
  selectedNodeVarIndex: 0
  visibleNodeVars: []

mounted: | #js
  function() {
  }

methods:
  getInitialSelectedTab: | #js
    function(var1) {
      if (!var1) return null;
      return this.tabOptions.findIndex(t => (var1.type == (t.split(' ').last())));
    }
  getNodeVarPath: | #js
    function(var1) {
      const nvp = this.$root.getNodeVarPath(this.node);
      return `${nvp}.${var1.name}`;
    }
  onTabChange: | #js
    function(var1, newTab) {
      if (!var1) return;
      var1.type = (newTab < 0) ? null : this.tabOptions[newTab]?.split(' ').last();
    }
  getVisibleNodeVars: | #js
    function(node) {
      return (node?.vars ?? [])
        .filter(v => (v.editable ?? true));
    }

watch:
  node:
    immediate: true
    deep: false
    handler: | #js
      this.visibleNodeVars = this.getVisibleNodeVars(this.node);

