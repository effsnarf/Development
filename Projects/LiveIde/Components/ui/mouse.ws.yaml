dom:
  div:
    slot: null
props:
  global: false
  ctrlRightClick: true
data:
  pos: {}
  hoveredElement: null
  posQueue: []
  updateInterval: 50
  isMounted: false
  dragStart: null
mounted: | #js
  function() {
    this.isMounted = true;
    const element = this.getElement();
    element.addEventListener("mousedown", this.onMouseDown);
    element.addEventListener("mouseup", this.onMouseUp);
    window.addEventListener("mousemove", this.onMouseMove);
    element.addEventListener("contextmenu", this.onContextMenu);
    this.update();
  }
unmounted: | #js
  function() {
    this.isMounted = false;
    alertify.message("unmounted");
  }
methods:
  onMouseDown: | #js
    function(e) {
      if (!this.global && e.target.tagName != "DIV") return;
      if (e.button != 0) return;
      if (this.dragStart) return;
      this.dragStart = { x: e.clientX, y: e.clientY };
    }
  onMouseUp: | #js
    function(e) {
      if (e.button != 0) return;
      this.dragStart = null;
    }
  onMouseMove: | #js
    function(e) {     
      const pos = { x: e.clientX, y: e.clientY };
      this.posQueue.push(pos);
    }
  onContextMenu: | #js
    function(e) {
      if (e.ctrlKey) return;
      e.preventDefault();
      e.stopPropagation();
      this.$emit("right-click", e);
    }
  updateHoveredElement: | #js
    function(pos) {
      var el = document.elementFromPoint(pos.x, pos.y);
      this.hoveredElement = el;
    }
  update: | #js
    async function() {
      if (!this.isMounted) return;
      const pos = this.posQueue.pop();
      if (pos) this.pos = pos;
      this.posQueue = [];
      setTimeout(this.update.bind(this), this.updateInterval);
    }
  getElement: | #js
    function() {
      return (this.global ? window : this.$el.parentElement);
    }
  cancelEvent: | #js
    function(e) {
      e.preventDefault();
      e.stopPropagation();
    }
watch:
  pos:
    handler: | #js
      function(pos) {
        this.$emit("move", pos);
        if (this.dragStart) {
          const delta = { dx: pos.x - this.dragStart.x, dy: pos.y - this.dragStart.y };
          this.dragStart = pos;
          this.$emit("drag", delta);
        }
        this.updateHoveredElement(pos);
      }
    deep: true
  hoveredElement: | #js
    function(newHoveredElement) {
      this.$emit("hovered-element", newHoveredElement);
    }
name: ui-mouse
_:
  examples:
    count: 0
template: <div class="comp-ui-mouse" path="-2129987381."><slot></slot></div>
