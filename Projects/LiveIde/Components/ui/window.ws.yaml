dom:
  div: 
    ':class': '{ hovered: isHovered, ''auto-expand'': autoExpand }'
    @dragenter: (e) => isHovered++
    @dragleave: (e) => isHovered--
    @mouseenter: (e) => { isHovered++; $emit('mouseenter', e); }
    @mouseleave: (e) => { isHovered--; $emit('mouseleave', e); }
    ':style': style
    .above:
      @dragenter: (e) => isHovered++
      @dragleave: (e) => isHovered--
      @mouseenter: (e) => isHovered++
      @mouseleave: (e) => isHovered--
      slot: 
        name: above
    .window:
      ui.mouse:
        @up: onMouseUp
        @drag: onMouseDrag
      .flex:
        slot: 
          name: title
      .content:
        ':style': contentStyle
        slot: 
          name: content
      .footer:
        v-if: 'false'
        .flex.justify-between:
          div: 
            v-for: size in sizes
            ui.button:
              ':text': size.width + 'x' + size.height
              @click: rect1.size = size
    .below:
      slot: 
        name: below
props:
  rect: null
  autoExpand: false
  centerCoords: false
  surfaceElement: null
data:
  sizes:
    - width: 300
      height: 200
    - width: 400
      height: 300
    - width: 500
      height: 400
  rect1:
    pos:
      x: 0
      'y': 0
    size:
      width: 300
      height: 200
  isDraggingMoving: false
  isDragging: false
  dragStartPos:
    x: 0
    'y': 0
  dragTimeout: null
  isHovered: 0
mounted: | #js
  function() {
  }
methods:
  move: | #js
    async function(pos) {
      this.rect1.pos = this.adjustPos(pos);
    }
  onMouseDrag: | #js
    async function(dpos) {
      if (!this.isDragging)
      {
        this.isDragging = true;
        this.dragStartPos = Objects.clone(this.rect1.pos);
      }
      this.isDraggingMoving = true;
      const pos = this.rect1.pos;
      pos.x += dpos.dx;
      pos.y -= dpos.dy;
      clearTimeout(this.dragTimeout);
      this.dragTimeout = setTimeout(() => {
        this.isDraggingMoving = false;
      }, 100);
    }
  onMouseUp: | #js
    async function() {
      if (!this.isDragging) return;
      this.isDragging = false;
      const pos = this.rect1.pos;
      if (Objects.areEqual(pos, this.dragStartPos)) return;
      this.$emit("drag-stop", this.adjustPos(pos));
    }
  getSurfaceCenter: | #js
    function(cssPosition) {
      const surfaceRect = this.getSurfaceRect();
      if (cssPosition == "fixed")
      {
        return {
          x: Math.round(surfaceRect.left + surfaceRect.width / 2),
          y: Math.round(surfaceRect.top + surfaceRect.height / 2)
        };
      }
      else
      {
        return {
          x: Math.round(surfaceRect.width / 2),
          y: Math.round(surfaceRect.height / 2)
        };
      }
    }
  getSurfaceRect: | #js
    function() {
      const surface = this.surfaceElement || window;
      const surfaceRect = this.$root.getAbsoluteRect(surface);
      return surfaceRect;
    }
  adjustRectCoords: | #js
    function(rect) {
      if (!this.centerCoords) return rect;
      const center = this.getSurfaceCenter();
      const pos = rect.pos;
      const size = rect.size;
      const x = pos.x + center.x;
      const y = center.y - pos.y;
      const width = size.width;
      const height = size.height;
      return { pos: { x, y }, size: { width, height } };
    }
  adjustPos: | #js
    function(pos) {
      if (!pos) return pos;
      if (!this.centerCoords) return pos;
      const center = this.getSurfaceCenter();
      const x = pos.x - center.x;
      const y = center.y - pos.y;
      return { x, y };
    }
  yamlify: | #js
    function(obj) {
      return jsyaml.dump(obj);
    }
computed:
  style: | #js
    function()
    {
      const center = this.getSurfaceCenter();
      const pos = this.rect1.pos;
      const size = this.rect1.size;
      const style = {};
      style.position = "absolute";
      style.left = `${center.x + pos.x - (size.width / 2)}px`;
      style.top = `${center.y - pos.y - (size.height / 2)}px`;
      style.width = (size.width + "px");
      style.height = (size.height + "px");
      if (!this.isDraggingMoving) style.transition = "0.3s";
      return style;
    }
  contentStyle: | #js
    function()
    {
      const style = {};
      const size = this.rect1.size;
      style.width = (size.width + "px");
      //style.height = (size.height + "px");
      style.transition = "0.3s";
      return style;
    }
watch:
  rect:
    handler: | #js
      function(rect) {
        this.rect1 = Objects.clone(rect);
      }
    immediate: true
    deep: true
  rect1:
    handler: | #js
      function(rect) {
        this.$emit("input", rect);
      }
    deep: true
style:
  .hovered:
    border: 2px solid red
  .above, .below:
    position: absolute
    width: 100%
    opacity: 0
    transition: 1s
  .below:
    transform: translate(0, -100%)
  .comp-ui-window.hovered .above, .comp-ui-window.hovered .below:
    opacity: 1
  .comp-ui-window.hovered .above:
    transform: translate(0, -100%)
  .comp-ui-window.hovered .below:
    transform: none
  .window:
    height: 100%
    padding: 0.5em
    background: 'linear-gradient(to right, #303030, #101010)'
    border: '1px solid #ffffff30'
    overflow: hidden
    box-shadow: '-0.5em 0.5em 0.5em #00000080'
    cursor: move
    user-select: none
    z-index: 10
  .content:
    overflow: auto
  .auto-expand .content:
    max-height: 0
  .auto-expand:hover .content:
    max-height: none
  .footer:
    opacity: 0
    max-height: 0.5em
    overflow: hidden
    transition: 0.3s
  .footer:hover:
    opacity: 1
    max-height: 3em
  .handle:
    position: absolute
    right: 0
    bottom: 0
    width: 1em
    height: 1em
    background: '#ffffff20'
    cursor: se-resize
    user-select: none
_:
  examples:
    count: 0
name: ui-window
template: >-
  <div class="comp-ui-window" :class="{ hovered: isHovered, 'auto-expand':
  autoExpand }" @dragenter="(e) =&gt; isHovered++" @dragleave="(e) =&gt;
  isHovered--" @mouseenter="(e) =&gt; { isHovered++; $emit('mouseenter', e); }"
  @mouseleave="(e) =&gt; { isHovered--; $emit('mouseleave', e); }"
  :style="style" path="-1324571510."><div class="above" @dragenter="(e) =&gt;
  isHovered++" @dragleave="(e) =&gt; isHovered--" @mouseenter="(e) =&gt;
  isHovered++" @mouseleave="(e) =&gt; isHovered--" path="-1324571510.0"><slot
  name="above" path="-1324571510.0.0"></slot></div><div class="window"
  path="-1324571510.1"><ui-mouse @up="onMouseUp" @drag="onMouseDrag"
  path="-1324571510.1.0"></ui-mouse><div class="flex"
  path="-1324571510.1.1"><slot name="title"
  path="-1324571510.1.1.0"></slot></div><div class="content"
  :style="contentStyle" path="-1324571510.1.2"><slot name="content"
  path="-1324571510.1.2.0"></slot></div><div class="footer" v-if="false"
  path="-1324571510.1.3"><div class="flex justify-between"
  path="-1324571510.1.3.0"><div v-for="size in sizes"
  path="-1324571510.1.3.0.0"><ui-button :text="size.width + 'x' + size.height"
  @click="rect1.size = size"
  path="-1324571510.1.3.0.0.0"></ui-button></div></div></div></div><div
  class="below" path="-1324571510.2"><slot name="below"
  path="-1324571510.2.0"></slot></div></div>
