dom:
  div:
    ui.textarea:
      v-model: yaml
      on_focus: isFocused = true
      on_blur: isFocused = false
    .error:
      v-if: error
      v-text: error
props:
  value: null
data:
  yaml: ''
  isFocused: false
  error: null
methods:
  updateYamlFromObject: |
    function() {
      let yaml = jsyaml.dump(this.value);
      yaml = yaml.replace(/ null/g, "");
      this.yaml = yaml;
    }
watch:
  value: |
    {
      handler: function() {
        if (this.isFocused) return;
        this.updateYamlFromObject();
      },
      immediate: true
    }
  yaml: |
    {
      handler() {
        try
        {
          this.error = null;
          let jso = jsyaml.load(this.yaml);
          this.$emit('input', jso);
        }
        catch (ex)
        {
          this.error = ex.message;
        }
      }
    }
  isFocused: |
    {
      handler(newValue) {
        if (newValue) return;
        // While editing, we're not updating the YAML from the object
        // because that would cause the cursor to jump around
        // When we lose focus, we update the YAML from the object
        this.updateYamlFromObject();
      }
    }
name: ui-json-editor
template: >-
  <div class="comp-ui-json-editor"><ui-textarea v-model="yaml" @focus="isFocused
  = true" @blur="isFocused = false"></ui-textarea><div class="error"
  v-if="error" v-text="error"></div></div>
