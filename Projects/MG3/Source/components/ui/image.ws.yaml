dom:
  component:
    ':is': getCompType()
    class: image
    ':url': url
    img:
      ref: image1
      ':class': getCssClass()
      ':src': (src || emptySrc)
      on_load: onLoad
props:
  imageID: null
  url: null
  square: null
data:
  width: null
  height: null
mounted: |
  function () {
    window.addEventListener(`resize`, function(event) {
      this.recalc();
    }.bind(this));
    // Detect if the image element changes its size
    let resizeObserver = new ResizeObserver(function(entries) {
      this.recalc();
    }.bind(this.$refs.image1));
  }
methods:
  onLoad: |
    function () {
      this.recalc();
      [1,2,3].forEach(i => setTimeout(this.recalc.bind(this), i * 100))
    }
  recalc: |
    function () {
      if (!this.$refs.image1) return;
      let rect = this.$refs.image1.getBoundingClientRect();
      this.width = Math.round(rect.width);
      this.height = Math.round(rect.height);
      this.$emit("load");
    }
  getCssClass: |
    function () {
      return { empty: !this.src, square: this.square };
    }
  getCompType: |
    function () {
      if (!this.url) return `div`;
      return `ui-link`;
    }
computed:
  src: |
    function () {
      if (this.imageID) return this.$root.url.image(this.imageID);
      return null;
    }
  emptySrc: |
    function () {
      return '/img/empty.png';
    }
style:
  .image, img:
    width: 100%
  .image:
    overflow: hidden
  .square:
    aspect-ratio: 1
    object-fit: cover
name: ui-image
template: >-
  <component class="comp-ui-image image" :is="getCompType()" :url="url"><img
  ref="image1" :class="getCssClass()" :src="(src || emptySrc)"
  @load="onLoad"/></component>
