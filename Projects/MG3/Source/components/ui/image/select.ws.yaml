dom:
  .flex:
    ui.image:
      ':imageID': value
      ':square': true
    ui.file.dropzone:
      on_file-drop: onFileDrop
      .dropzone:
        .flex:
          class: justify-center
          div:
            v-text: dropAreaText
          div#2:
            ui.loading: null
            v-if: isUploading
props:
  value: null
data:
  imageID: null
  noBgImageID: null
  isUploading: false
methods:
  onFileDrop: | #js
    function (files) {
      ([...files]).forEach(this.uploadFile.bind(this));
    }
  uploadFile: | #js
    async function(file) {
      let url = "https://img.memegenerator.net/upload";

      this.isUploading = true;

      var xhr = new XMLHttpRequest();
      var formData = new FormData();
      xhr.open('POST', url, true);

      xhr.addEventListener('readystatechange', function(e) {
        if (xhr.readyState == 4 && xhr.status == 200) {
          this.isUploading = false;
          const image = JSON.parse(xhr.responseText);
          this.$emit('input', image._id);
        }
        else if (xhr.readyState == 4 && xhr.status != 200) {
          this.isUploading = false;
          alertify.error("An error occurred while uploading the file.");
        }
      }.bind(this));

      formData.append('image', file);
      xhr.send(formData);
    }
computed:
  dropAreaText: | #js
    function () {
      if (this.isUploading) return "uploadingâ€¦";
      return "drop image here";
    }
watch:
  isUploading: | #js
    function (isUploading) {
      this.$emit('uploading', isUploading);
    }
style:
  .flex:
    gap: 0.5rem
  .comp-ui-image:
    width: 15% !important
  .comp-ui-file-dropzone:
    width: 85% !important
    font-size: 160%
    text-align: center
    font-family: monospace
  .dropzone:
    border: 6px dashed white
    opacity: 0.3
name: ui-image-select
template: >-
  <div class="comp-ui-image-select flex"><ui-image :imageID="value"
  :square="true"></ui-image><ui-file-dropzone @file-drop="onFileDrop"><div
  class="dropzone"><div class="justify-center flex"><div
  v-text="dropAreaText"></div><div
  v-if="isUploading"><ui-loading></ui-loading></div></div></div></ui-file-dropzone></div>
