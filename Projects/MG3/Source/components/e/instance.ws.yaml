dom:
  div: 
    @click: $emit('click')
    v-if: instance
    ui.link:
      ':url': $root.url.instance(instance)
      class: instance
      div: 
        ui.image:
          ref: image1
          ':imageID': >-
            instanceImage ? null : (instance.imageID ||
            instance.generator?.imageID)
          ':url': $root.url.itemImage(instance)
          @change: updateImageSize
        .texts:
          v-if: '!instanceImage'
          .text:
            v-for: (text, index) in [instance.text0, instance.text1]
            v-text: text
            ':style': '{ fontSize: fontSizes[index] }'
        div: 
          class: spacer
    .footer:
      v-if: showFooter && !showFullFooter
      e.generator.wide2: 
        ':generator': $root.instanceToGenerator(instance)
    .footer2:
      v-if: showFullFooter
      e.generator.wide2: 
        ':generator': $root.instanceToGenerator(instance)
      ui.share:
        ':item': instance
    e.post.create:
      v-if: showCreatePost
      ':generator': $root.instanceToGenerator(instance)
      ':entityID': instance._id
name: e-instance
props:
  item: null
  instanceImage: false
  showFooter: true
  showFullFooter: false
  showCreatePost: false
  instanceID: null
data:
  width: null
  instance: null
methods:
  getFontSize: | #js
    function (s) {
      if (!s) return 0;
      if (!this.width) return 0;
      const size = Math.min(3, Math.max(14, (36 - (s.length / 6))) / 50 *  this.width / 150);
      return `${size*2.5}vh`;
    }
  updateImageSize: | #js
    function () {
      this.width = this.$refs.image1.width;
    }
computed:
  showGenerator: | #js
    function () {
      if (!this.instance) return false;
      if (this.instance.urlName == this.$root.params.urlName) return false;
      return true;
    }
  fontSizes: | #js
    function () {
      if (!this.instance) return [0, 0];
      const sizes = [this.getFontSize(this.instance.text0), this.getFontSize(this.instance.text1)];
      return sizes;
    }
watch:
  item:
    handler: | #js
      function (item) {
        this.instance = item;
      }
    immediate: true
  instanceID:
    handler: | #js
      async function (instanceID) {
        if (this.item) return;
        this.instance = !instanceID ? null : await this.$root.dbp.instances.select.one(instanceID);
      }
    immediate: true
style:
  .instance:
    display: block
    box-shadow: '0px 10px 10px #000000a0'
  .footer:
    margin-top: 1em
  .footer2:
    margin-top: 1em
    display: grid
    grid-template-columns: 4fr 2fr
  .footer2 .comp-e-generator-wide2:
    font-size: 140%
  .admin-footer:
    display: flex
    justify-content: center
    margin-top: 1rem
  .comp-e-post-create:
    margin-top: 1rem !important
  .comp-ui-image:
    width: 100%
  .comp-ui-image, img:
    aspect-ratio: 1
    object-fit: cover
  .instance .comp-ui-image, .texts, .text:
    position: absolute
  .spacer, .texts:
    width: 100%
    aspect-ratio: 1
  .text:
    text-align: center
    display: block
    width: 100%
    top: 0
    overflow: hidden
    color: '#fff'
    line-height: 1.2em
    font-family: Impact,Oswald
    text-transform: uppercase
    text-shadow: '-2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000'
    '-webkit-font-smoothing': antialiased
    box-sizing: border-box
    padding: 0.3em
    filter: 'drop-shadow(-2px 4px 2px #00000060)'
    transition: 0s
  .text:nth-child(2):
    top: auto
    bottom: 0
template: >-
  <div class="comp-e-instance" @click="$emit('click')" v-if="instance"
  path="643573758."><ui-link class="instance"
  :url="$root.url.instance(instance)" path="643573758.0"><div
  path="643573758.0.0"><ui-image ref="image1" :imageID="instanceImage ? null :
  (instance.imageID || instance.generator?.imageID)"
  :url="$root.url.itemImage(instance)" @change="updateImageSize"
  path="643573758.0.0.0"></ui-image><div class="texts" v-if="!instanceImage"
  path="643573758.0.0.1"><div class="text" v-for="(text, index) in
  [instance.text0, instance.text1]" v-text="text" :style="{ fontSize:
  fontSizes[index] }" path="643573758.0.0.1.0"></div></div><div class="spacer"
  path="643573758.0.0.2"></div></div></ui-link><div class="footer"
  v-if="showFooter &amp;&amp; !showFullFooter"
  path="643573758.1"><e-generator-wide2
  :generator="$root.instanceToGenerator(instance)"
  path="643573758.1.0"></e-generator-wide2></div><div class="footer2"
  v-if="showFullFooter" path="643573758.2"><e-generator-wide2
  :generator="$root.instanceToGenerator(instance)"
  path="643573758.2.0"></e-generator-wide2><ui-share :item="instance"
  path="643573758.2.1"></ui-share></div><e-post-create v-if="showCreatePost"
  :generator="$root.instanceToGenerator(instance)" :entityID="instance._id"
  path="643573758.3"></e-post-create></div>
