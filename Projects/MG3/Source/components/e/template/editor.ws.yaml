dom:
  div: 
    v-if: temp
    ':class': getCssClass()
    .div1:
      div: 
        ui.tree:
          ':root': temp
          ':initial-expanded': 2
          item-type: e.template.item.icon
          ':get-item': (node) => node
          ':get-children': (node) => node.items
          @node-select: selectedItem = $event
      .div2:
        ui.image.select:
          class: hidden
          ref: imageSelect1
          v-if: (selectedItem?.type=='image')
          v-model: selectedItem.imageID
        e.template.grid.item:
          ':item': temp
          @file-drop: (item, files) => onFileDrop(item, files)
        .text-center.mt-l2:
          ui.loading:
            v-if: isCreatingMedia
          ui.button:
            v-if: '!isCreatingMedia'
            ':text': '''✔️ Create'''
            @click: createMedia
        div: 
          v-if: selectedItem && showPropertyEditor
          ui.section: 
            ':title': selectedItem.type
            v-model: showFilters
            ':opposite': true
            transition:
              name: slide2
              component:
                ref: selectedItemEditor1
                ':is': selectedItemEditorType
                ':item': selectedItem
                @toggle-disabled: toggleDisabled($event)
                ':key': selectedItemIndex
          ui.section: 
            v-if: canApplyEffects(selectedItem)
            title: effects
            v-model: showFilters
            e.template.item.filters:
              ':imageID': selectedItem.imageID
              v-model: selectedItem.filters
              @input: () => onItemChange(selectedItem)
      .help:
        .message: 
          video: 
            autoplay: true
            muted: true
            loop: true
            src: /video/interface/image/drop.webm
          div: 
            v-text: '''Drop images on boxes to upload.'''
        .message: 
          video: 
            autoplay: true
            muted: true
            loop: true
            src: /video/interface/image/move.webm
          div: 
            v-text: '''Drag images inside boxes to move.'''
        .message: 
          video: 
            autoplay: true
            muted: true
            loop: true
            src: /video/interface/image/scale.webm
          div: 
            v-text: '''Ctrl-drag images inside boxes to resize.'''
        .message: 
          class: large-video
          video: 
            autoplay: true
            muted: true
            loop: true
            src: /video/interface/image/visible.webm
          div: 
            v-text: '''Toggle image visibility using the tree on the left.'''
        .message: 
          class: large-video
          video: 
            autoplay: true
            muted: true
            loop: true
            src: /video/interface/image/rotate.webm
          div: 
            v-text: >-
              'If less than 4 images are visible, click the title (Body, Hair..)
              to change the layout.'
props:
  temp: null
  showPropertyEditor: true
data:
  selectedItemIndex: 0
  disabled: 0
  showFilters: false
  isCreatingMedia: false
mounted: | #js
  async function() {
    await this.init();
  }
methods:
  init: | #js
    async function() {
    }
  onFileDrop: | #js
    async function(item, files) {
      await this.$nextTick();
      if (files.length > 1) return alertify.error('One file at a time, please');
      item.isLoading = true;
      try
      {
        const image = await this.$root.uploadFile(files[0]);
        item.imageID = image._id;
      }
      finally
      {
        item.isLoading = false;
      }
    }
  canApplyEffects: | #js
    function(item) {
      if (!item) return false;
      return item.type === 'image';
    }
  getCssClass: | #js
    function() {
      return {
        disabled: (this.disabled > 0)
      };
    }
  selectItem: | #js
    function(index) {
      this.selectedItemIndex = index;
    }
  onItemChange: | #js
    function(item) {
    }
  getTabClass: | #js
    function(index) {
      return {
        clickable: true,
        'selected': index === this.selectedItemIndex
      };
    }
  toggleDisabled: | #js
    function(disabled) {
      if (disabled) this.disabled++;
      else this.disabled--;
    }
  createMedia: | #js
    async function() {
      this.isCreatingMedia = true;
      try
      {
        let media = { template: this.temp };
        media = await this.$root.dbp.medias.create.one(media);
        console.log(media);
      }
      finally
      {
        this.isCreatingMedia = false;
      }
    }
  eval: | #js
    function(s) {
      return eval(s);
    }
computed:
  selectedItem: | #js
    function() {
      return this.temp;
      //return this.temp.items[this.selectedItemIndex];
    }
  selectedItemEditorType: | #js
    function() {
      if (!this.selectedItem) return;
      return `e-template-${this.selectedItem.type}-editor`;
    }
  imageItems: | #js
    function() {
      return this.temp.items.filter(item => item.type === 'image');
    }
name: e-template-editor
style:
  .div1:
    display: grid
    grid-template: 1fr / 1fr 4fr 2fr
    margin-bottom: 5rem
    gap: 1em
  .div1 > div:
    overflow: hidden
  .div2:
    display: flex
    flex-direction: column
    gap: 1em
  .tabs:
    display: flex
    flex-direction: column-reverse
    align-items: end
    justify-content: start
  .tabs input[type="checkbox"]:
    position: relative
    top: 0.1em
    transform: scale(0.7)
  .tabs li:
    transition: 0.3s;
  .tabs li.selected:
    transform: scale(1.2);
  .layout-layers:
    aspect-ratio: 1 / 1
    overflow: hidden
  .layout-layers .layer:
    position: absolute
    top: 0
    left: 0
    width: 100%
    height: 100%
    pointer-events: none
  .layout-layers .layer .comp-ui-image: null
  .layout-vertical:
    border: '2px solid #ffffff60'
    display: flex
    flex-direction: column-reverse
  .layout-vertical .item:
    width: 100%
  .layout-vertical, .layout-vertical .item:
    overflow: hidden
  .item:
    overflow: hidden
  .item.selected, .item.selected:hover:
    background: none !important
  .help .message:
    display: grid
    grid-template: 1fr / 1fr 2fr
    gap: 1em
    text-align: left
  .help video:
    filter: grayscale(1)
  .message.large-video:
    grid-template: 1fr / 1fr
template: >-
  <div class="comp-e-template-editor" v-if="temp" :class="getCssClass()"
  path="-650358312."><div class="div1" path="-650358312.0"><div
  path="-650358312.0.0"><ui-tree :root="temp" :initial-expanded="2"
  item-type="e.template.item.icon" :get-item="(node) =&gt; node"
  :get-children="(node) =&gt; node.items" @node-select="selectedItem = $event"
  path="-650358312.0.0.0"></ui-tree></div><div class="div2"
  path="-650358312.0.1"><ui-image-select class="hidden" ref="imageSelect1"
  v-if="(selectedItem?.type=='image')" v-model="selectedItem.imageID"
  path="-650358312.0.1.0"></ui-image-select><e-template-grid-item :item="temp"
  @file-drop="(item, files) =&gt; onFileDrop(item, files)"
  path="-650358312.0.1.1"></e-template-grid-item><div class="text-center mt-l2"
  path="-650358312.0.1.2"><ui-loading v-if="isCreatingMedia"
  path="-650358312.0.1.2.0"></ui-loading><ui-button v-if="!isCreatingMedia"
  :text="'✔️ Create'" @click="createMedia"
  path="-650358312.0.1.2.1"></ui-button></div><div v-if="selectedItem &amp;&amp;
  showPropertyEditor" path="-650358312.0.1.3"><ui-section
  :title="selectedItem.type" v-model="showFilters" :opposite="true"
  path="-650358312.0.1.3.0"><transition name="slide2"
  path="-650358312.0.1.3.0.0"><component ref="selectedItemEditor1"
  :is="selectedItemEditorType" :item="selectedItem"
  @toggle-disabled="toggleDisabled($event)" :key="selectedItemIndex"
  path="-650358312.0.1.3.0.0.0"></component></transition></ui-section><ui-section
  v-if="canApplyEffects(selectedItem)" title="effects" v-model="showFilters"
  path="-650358312.0.1.3.1"><e-template-item-filters
  :imageID="selectedItem.imageID" v-model="selectedItem.filters" @input="()
  =&gt; onItemChange(selectedItem)"
  path="-650358312.0.1.3.1.0"></e-template-item-filters></ui-section></div></div><div
  class="help" path="-650358312.0.2"><div class="message"
  path="-650358312.0.2.0"><video autoplay="true" muted="true" loop="true"
  src="/video/interface/image/drop.webm" path="-650358312.0.2.0.0"></video><div
  v-text="'Drop images on boxes to upload.'"
  path="-650358312.0.2.0.1"></div></div><div class="message"
  path="-650358312.0.2.1"><video autoplay="true" muted="true" loop="true"
  src="/video/interface/image/move.webm" path="-650358312.0.2.1.0"></video><div
  v-text="'Drag images inside boxes to move.'"
  path="-650358312.0.2.1.1"></div></div><div class="message"
  path="-650358312.0.2.2"><video autoplay="true" muted="true" loop="true"
  src="/video/interface/image/scale.webm" path="-650358312.0.2.2.0"></video><div
  v-text="'Ctrl-drag images inside boxes to resize.'"
  path="-650358312.0.2.2.1"></div></div><div class="large-video message"
  path="-650358312.0.2.3"><video autoplay="true" muted="true" loop="true"
  src="/video/interface/image/visible.webm"
  path="-650358312.0.2.3.0"></video><div v-text="'Toggle image visibility using
  the tree on the left.'" path="-650358312.0.2.3.1"></div></div><div
  class="large-video message" path="-650358312.0.2.4"><video autoplay="true"
  muted="true" loop="true" src="/video/interface/image/rotate.webm"
  path="-650358312.0.2.4.0"></video><div v-text="'If less than 4 images are
  visible, click the title (Body, Hair..) to change the layout.'"
  path="-650358312.0.2.4.1"></div></div></div></div></div>
