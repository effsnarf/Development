dom:
  .items:
    v-if: item
    transition: 
      name: slide2
      div: 
        transition: 
          name: slide2
          .flex.justify-between:
            v-if: (item.imageID && !removingBackground)
            ui.expand:
              v-if: 'false'
              text: shadow
              v-model: showShadowEditor
            ui.checkbox:
              v-if: temp?.can?.remove?.background
              text: remove background
              v-model: item.removeBackground
        e.template.caption.editor:
          v-if: item.caption
          ':item': item.caption
          ':minimal': 'true'
        transition: 
          name: slide2
          .message:
            v-if: removingBackground
            div: 
              v-text: '''Removing background'''
            ui.loading: null
    div:
      transition: 
        name: slide2
        div: 
          v-if: showShadowEditor
          ui.range: 
            text: x
            v-model: item.shadow.x
            min: -1
            max: 1
            step: 0.01
          ui.range: 
            text: 'y'
            v-model: item.shadow.y
            min: -1
            max: 1
            step: 0.01
          ui.range: 
            text: blur
            v-model: item.shadow.blur
            min: 0
            max: 1
            step: 0.01
          ui.range: 
            text: opacity
            v-model: item.shadow.opacity
            min: 0
            max: 1
            step: 0.01
props:
  temp: null
  item: null
data:
  removingBackground: false
  showMoveScale: false
  showShadowEditor: false
  processingNewImage: false
style:
  .comp-ui-image-select:
    margin-top: 1em
mounted: | #js
  async function() {
    this.$watch(() => this.item?.removeBackground, (removeBackground) => {
      this.removingBackground = removeBackground
    });
  }
methods:
  onLayerDragBy: | #js
    function(dpos) {
      const pos = (this.showShadowEditor ? this.item.shadow : this.item.trans.pos);
      pos.x += dpos.dx;
      pos.y += dpos.dy;
    }
  onLayerScaleBy: | #js
    function(ds) {
      if (this.showShadowEditor) {
        this.item.shadow.blur += ds;
      }
      else
      {
        this.item.trans.scale += ds;
      }
    }
  onImageUploading: | #js
    function(isUploading) {
      if (isUploading) {
        this.processingNewImage = true;
        this.item.removeBackground = false;
      }
      this.$emit('toggle-disabled', isUploading);
    }
  onItemImageLoad: | #js
    function(src) {
      if (src.includes(".nobg."))
      {
        this.removingBackground = false;
        this.processingNewImage = false;
      }
      else
      {
        if (this.processingNewImage)
        {
          // After a user uploads a new image,
          // we wait until the browser loads the image
          // and then mark the checkbox to remove the background.
          this.item.trans.pos.x = 0.5;
          this.item.trans.pos.y = 0.5;
          this.item.trans.scale = 1;
          setTimeout(() => {
            this.item.removeBackground = true;
          }, 100);
        }
      }
    }
watch:
  processingNewImage: | #js
    function(newValue) {
      this.$emit('toggle-disabled', newValue);
    }
name: e-template-image-editor
template: >-
  <div class="comp-e-template-image-editor items" v-if="item"
  path="1046603147."><transition name="slide2" path="1046603147.0"><div
  path="1046603147.0.0"><transition name="slide2" path="1046603147.0.0.0"><div
  class="flex justify-between" v-if="(item.imageID &amp;&amp;
  !removingBackground)" path="1046603147.0.0.0.0"><ui-expand v-if="false"
  text="shadow" v-model="showShadowEditor"
  path="1046603147.0.0.0.0.0"></ui-expand><ui-checkbox
  v-if="temp?.can?.remove?.background" text="remove background"
  v-model="item.removeBackground"
  path="1046603147.0.0.0.0.1"></ui-checkbox></div></transition><e-template-caption-editor
  v-if="item.caption" :item="item.caption" :minimal="true"
  path="1046603147.0.0.1"></e-template-caption-editor><transition name="slide2"
  path="1046603147.0.0.2"><div class="message" v-if="removingBackground"
  path="1046603147.0.0.2.0"><div v-text="'Removing background'"
  path="1046603147.0.0.2.0.0"></div><ui-loading></ui-loading></div></transition></div></transition><div
  path="1046603147.1"><transition name="slide2" path="1046603147.1.0"><div
  v-if="showShadowEditor" path="1046603147.1.0.0"><ui-range text="x"
  v-model="item.shadow.x" min="-1" max="1" step="0.01"
  path="1046603147.1.0.0.0"></ui-range><ui-range text="y"
  v-model="item.shadow.y" min="-1" max="1" step="0.01"
  path="1046603147.1.0.0.1"></ui-range><ui-range text="blur"
  v-model="item.shadow.blur" max="1" step="0.01"
  path="1046603147.1.0.0.2"></ui-range><ui-range text="opacity"
  v-model="item.shadow.opacity" max="1" step="0.01"
  path="1046603147.1.0.0.3"></ui-range></div></transition></div></div>
