dom:
  .thread-columns:
    v-if: thread
    .media-column:
      ':key': key1
      v-if: media
      e.media:
        ':media': media
        @thread-updated: refresh
    .posts-column:
      div:
        v-if: thread
        h3:
          v-text: thread.title
        transition.group:
          tag: ul
          name: list
          li:
            v-for: (post, index) in visiblePosts
            ':key': post?._id||0
            e.post:
              ':item': post
              @thread-updated: refresh
            .text-center.opacity-30:
              v-if: getHiddenPostsCount(index)
              v-text: '''('' + getHiddenPostsCount(index) + '' posts…)'''
      transition:
        name: slide
        ui.loading:
          v-if: isLoading
      e.post.create:
        ':threadID': thread?._id
        ':threadMediaID': media?._id
        @created: reload
      .mt-l2:
        ui.button:
          v-if: $root.isAdmin
          ':text': '''♻ reload'''
          ':click': reload
props:
  thread: null
  teaser: false
data:
  key1: 1
  isLoading: false
mounted: | #js
  async function() {
  }
methods:
  getHiddenPostsCount: | #js
    function(index) {
      const post = this.visiblePosts[index];
      const nextPost = this.visiblePosts[index + 1];
      if (!post || !nextPost) return null;
      return (nextPost.index - post.index - 1);
    }
  isRelevantThread: | #js
    function(thread) {
      if (!this.thread) return false;
      if (this.thead._id == thread?._id) return true;
      return false;
    }
  refresh: | #js
    function() {
      this.key1++;
    }
  reload: | #js
    async function() {
      this.$root.$emit('thread-updated', this.thread);
    }
computed:
  media: | #js
    function() {
      return this.thread?.posts[0]?.media;
    }
  visiblePosts: | #js
    function() {
      if (!this.thread) return [];
      const posts1 = [...this.thread.posts];
      // OP is shown on the left
      posts1.shift();
      if (!this.teaser) return posts1;
      // Thread teaser
      let vPosts = [];
      // Take the first two and the last two posts
      vPosts.push(...posts1.slice(0, 2));
      vPosts.push(...posts1.slice(-2));
      // Make sure there are no duplicates
      vPosts = vPosts.filter((post, index, self) => self.findIndex(p => p._id === post._id) === index);
      // Return
      return vPosts;
    }
watch:
  thread:
    handler: | #js
      function() {
        this.refresh();
      }
style:
  .thread-columns:
    display: grid
    grid-template: 1fr / 1fr 1fr
    gap: 2vw
  ul:
    margin: auto
  li:
    margin-bottom: 1vh
name: e-thread
template: >-
  <div class="comp-e-thread thread-columns" path="1226205107."><div
  class="media-column" :key="key1" v-if="media" path="1226205107.0"><e-media
  :media="media" @thread-updated="refresh"
  path="1226205107.0.0"></e-media></div><div class="posts-column"
  path="1226205107.1"><div v-if="thread" path="1226205107.1.0"><h3
  v-text="thread.title" path="1226205107.1.0.0"></h3><transition-group tag="ul"
  name="list" path="1226205107.1.0.1"><li v-for="(post, index) in visiblePosts"
  :key="post?._id||0" path="1226205107.1.0.1.0"><e-post :item="post"
  @thread-updated="refresh" path="1226205107.1.0.1.0.0"></e-post><div
  class="text-center opacity-30" v-if="getHiddenPostsCount(index)" v-text="'(' +
  getHiddenPostsCount(index) + ' posts…)'"
  path="1226205107.1.0.1.0.1"></div></li></transition-group></div><transition
  name="slide" path="1226205107.1.1"><ui-loading v-if="isLoading"
  path="1226205107.1.1.0"></ui-loading></transition><e-post-create
  :threadID="thread?._id" :threadMediaID="media?._id" @created="reload"
  path="1226205107.1.2"></e-post-create><div class="mt-l2"
  path="1226205107.1.3"><ui-button v-if="$root.isAdmin" :text="'♻ reload'"
  :click="reload" path="1226205107.1.3.0"></ui-button></div></div></div>
