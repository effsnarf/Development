dom:
  site:
    page-name: thread
    ':columns-focus-left': columnsFocusLeft
    ':content-not-found': contentNotFound
    template: 
      v-slot: left
      .flex.ver.gap-2:
        e.thread.create:
          @input:columnsFocusLeft: columnsFocusLeft=$event
        ui.link:
          ':text': '''ðŸ”™ catalog'''
          url: /catalog
    template: 
      v-slot: middle
      e.post:
        ':item': thread?.posts[0]
    template: 
      v-slot: right
      .flex.gap-2:
        transition:
          name: slide-large
          e.thread:
            ':thread': thread
data:
  thread: null
  contentNotFound: false
  columnsFocusLeft: false
mounted: | #js
  async function() {
    this.$watch(() => [this.$root.params.threadID, this.$root.params.mediaID], {
      handler: async () => {
        await this.init(this.$root.params.threadID, this.$root.params.mediaID);
      },
      immediate: true
    });

    this.$root.$on("thread-updated", this.refresh.bind(this));
  }
methods:
  init: | #js
    async function(threadID, threadMediaID) {
      const dbp = this.$root.dbp;
      this.clear();
      if (!threadID && !threadMediaID) return;
      try
      {
        this.$root.isLoading++;
        this.thread = null;
        this.thread = await dbp.threads.select.one(threadID, threadMediaID);
        this.$root.setDocumentTitle(this.$root.getMediaText(this.media));
        if (!this.thread) this.contentNotFound = true;
      }
      finally
      {
        this.$root.isLoading--;
      }
    }
  refresh: | #js
    async function(thread) {
      if (!this.thread) return;
      if (this.thread._id != thread?._id) return;
      thread = await this.$root.dbp.threads.select.one(this.thread._id);
      this.thread.posts.splice(0, this.thread.posts.length, ...thread.posts);
    }
  clear: | #js
    function() {
      this.media = null;
      this.contentNotFound = false;
    }
watch: null
name: page-thread
style: null
template: >-
  <site class="comp-page-thread" page-name="thread"
  :columns-focus-left="columnsFocusLeft" :content-not-found="contentNotFound"
  path="-1535040951."><template v-slot:left path="-1535040951.0"><div
  class="flex ver gap-2" path="-1535040951.0.0"><e-thread-create
  @input:columnsFocusLeft="columnsFocusLeft=$event"
  path="-1535040951.0.0.0"></e-thread-create><ui-link :text="'ðŸ”™ catalog'"
  url="/catalog" path="-1535040951.0.0.1"></ui-link></div></template><template
  v-slot:middle path="-1535040951.1"><e-post :item="thread?.posts[0]"
  path="-1535040951.1.0"></e-post></template><template v-slot:right
  path="-1535040951.2"><div class="flex gap-2"
  path="-1535040951.2.0"><transition name="slide-large"
  path="-1535040951.2.0.0"><e-thread :thread="thread"
  path="-1535040951.2.0.0.0"></e-thread></transition></div></template></site>
