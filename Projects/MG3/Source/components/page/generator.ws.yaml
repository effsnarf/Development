dom:
  site:
    page-name: generator
    ':title-image-id': generator?.imageID
    ':title-text': generator?.displayName
    ':title-url': $root.url.generator(generator)
    ':title-key': generator?.generatorID
    ':recommendation-items': recommendationItems
    template:
      v-slot: article
      ui.image:
        class: mb-l2
        imageID: 680118406
        :aspect-ratio: "5/1"
        object-position: top
      div:
        div:
          class: float-left mr-l1
          :style: "{ width: '30%' }"
          e.instance:
            :instanceID: 18334939
        .description:
          v-html: "'<h1>Socially Awkward Penguin</h1> is a popular internet meme that depicts a penguin character embodying the traits of social awkwardness. The meme typically features a simple illustration of a penguin with a slightly tilted head and a shy expression. It represents those relatable moments when individuals find themselves in uncomfortable or socially challenging situations. Socially Awkward Penguin serves as a lighthearted way to express and relate to the awkwardness many people experience in their daily lives, creating a sense of camaraderie and humor within online communities.'"
        div:
          class: float-clear
        e.teaser:
          imageID: 1058
        e.teaser:
          imageID: 4367294
        e.teaser:
          imageID: 2795748
        e.teaser:
          imageID: 1255
        e.teaser:
          imageID: 565919
      content.article:
        v-if: poem
        template:
          v-slot: content
          .poem:
            transition.group:
              name: list
              content.poem.stanza:
                v-for: stanza in getRandomStanzas(poem)
                ':item': stanza
                ':key': stanza.map(l => l.substring(0, 5)).join('-')
          div:
            class: float-clear
    template:
      v-slot: middle
      content.stream:
        ref: contentStream1
        item-type: e.instance
        ':get-more-items': getMoreInstances
        grid-class: grid-1
    template:
      v-slot: left
      e.instance.create:
        v-if: showCreateInstance
        ':generator': generator
        @instance-created: onInstanceCreated
data:
  urlName: null
  generator: null
  poem: null
  recommendationItems: []
  showCreateInstance: false
mounted: | #js
  async function() {
    this.$watch(() => this.$root.params.urlName, {
      handler: async () => {
        await this.init();
      },
      immediate: true
    });
  }
methods:
  init: | #js
    async function() {
      const dbp = this.$root.dbp;
      if (this.urlName == this.$root.params.urlName) return;
      this.urlName = this.$root.params.urlName;
      if (!this.urlName) return;
      this.clear();
      try
      {
        this.$root.isLoading = true;
        this.generator = !this.urlName ? null : await dbp.generators.select.one(null, this.urlName);
        this.recommendationItems.replace(async() => await dbp.generators.select.related(this.urlName), 500, gen => gen.generatorID);
        this.$refs.contentStream1?.reset();
        setTimeout(() => {
          this.poem = this.generator?.desc?.poem;
        }, 500);
        if (this.$root.params.page == "generator") {
          this.$root.setDocumentTitle(this.generator?.displayName);
        }
      }
      finally
      {
        this.$root.isLoading = false;
      }
    }
  clear: | #js
    function() {
      this.generator = null;
      this.poem = null;
      this.recommendationItems = [];
      this.$refs.contentStream1?.reset();
    }
  getMoreInstances: | #js
    async function(pageIndex) {
      await this.init();
      if (!this.urlName) return [];
      const items = await this.$root.dbp.instances.select.popular("en", pageIndex, this.urlName)
      return items;
    }
  getRandomStanzas: | #js
    function(poem) {
      if (!poem) return [];
      // Return random stanzas
      const stanzas = [...poem];
      const result = [];
      for (let i = 0; i < 1; i++) {
        const index = Math.floor(Math.random() * stanzas.length);
        result.push(stanzas[index]);
        stanzas.splice(index, 1);
      }
      return result;
    }
  onInstanceCreated: | #js
    function(instance) {
      this.$refs.contentStream1?.add(instance);
    }
watch:
  generator: | #js
    function(newGenerator) {
      if (!newGenerator)
      {
        this.showCreateInstance = false;
        return;
      }
      setTimeout(() => {
        this.showCreateInstance = true;
      }, 2000);
    }
style:
  .description h1:
    display: block
    font-size: 3rem
    line-height: 1.5em
  .poem: null
  .poem .comp-content-poem-stanza:
    margin: 1rem auto
  .poem .line:nth-child(1):
    font-size: 160%
  .float-clear:
    clear: both
name: page-generator
template: >-
  <site class="comp-page-generator" page-name="generator"
  :title-image-id="generator?.imageID" :title-text="generator?.displayName"
  :title-url="$root.url.generator(generator)"
  :title-key="generator?.generatorID"
  :recommendation-items="recommendationItems" path="-38884812."><template
  v-slot:article path="-38884812.0"><content-article v-if="poem"
  path="-38884812.0.0"><template v-slot:content path="-38884812.0.0.0"><div
  class="poem" path="-38884812.0.0.0.0"><transition-group name="list"
  path="-38884812.0.0.0.0.0"><content-poem-stanza v-for="stanza in
  getRandomStanzas(poem)" :item="stanza" :key="stanza.map(l =&gt; l.substring(0,
  5)).join('-')"
  path="-38884812.0.0.0.0.0.0"></content-poem-stanza></transition-group></div><div
  class="float-clear"
  path="-38884812.0.0.0.1"></div></template></content-article></template><template
  v-slot:middle path="-38884812.1"><content-stream ref="contentStream1"
  item-type="e.instance" :get-more-items="getMoreInstances" grid-class="grid-1"
  path="-38884812.1.0"></content-stream></template><template v-slot:left
  path="-38884812.2"><e-instance-create v-if="showCreateInstance"
  :generator="generator" @instance-created="onInstanceCreated"
  path="-38884812.2.0"></e-instance-create></template></site>
