dom:
  site:
    page-name: generator
    ':recommendation-items': recommendationItems
    template#1:
      v-slot: article
      content.title:
        ':imageID': generator?.imageID
        ':title': generator?.displayName
        ':url': $root.url.generator(generator)
      content.article:
        template:
          v-slot: content
          .poem:
            content.poem.stanza:
              v-for: stanza in getRandomStanzas(generator?.desc?.poem)
              ':item': stanza
          div:
            class: float-clear
    template#2:
      v-slot: middle
      content.stream:
        item-type: e.instance
        ':get-more-items': getMoreInstances
        grid-class: grid-1
data:
  generator: null
  recommendationItems: []
  isInited: false
mounted: |
  async function() {
    this.$watch(() => this.$root.params.urlName, {
      handler: async () => {
        await this.init();
      },
      immediate: true
    });
  }
methods:
  init: |
    async function() {
      if (this.isInited) return;
      const dbp = this.$root.dbp;
      this.urlName = this.$root.params.urlName;
      this.generator = !this.urlName ? null : await dbp.generators.select.one(null, this.urlName);
      this.recommendationItems = await dbp.generators.select.related(this.urlName);
      this.isInited = true;
    }
  getMoreInstances: |
    async function(pageIndex) {
      await this.init();
      const items = await this.$root.dbp.instances.select.popular("en", pageIndex, this.urlName)
      return items;
    }
  getRandomStanzas: |
    function(poem) {
      if (!poem) return [];
      // Return random stanzas
      const stanzas = [...poem];
      const result = [];
      for (let i = 0; i < 1; i++) {
        const index = Math.floor(Math.random() * stanzas.length);
        result.push(stanzas[index]);
        stanzas.splice(index, 1);
      }
      return result;
    }
style:
  .poem:
    float: clear
  .poem .comp-content-poem-stanza:
    float: left
    margin: 1rem
  .poem .line:nth-child(1):
    font-size: 160%
  .float-clear:
    clear: both
name: page-generator
template: >-
  <site class="comp-page-generator" page-name="generator"
  :recommendation-items="recommendationItems"><template
  v-slot:article><content-title :imageID="generator?.imageID"
  :title="generator?.displayName"
  :url="$root.url.generator(generator)"></content-title><content-article><template
  v-slot:content><div class="poem"><content-poem-stanza v-for="stanza in
  getRandomStanzas(generator?.desc?.poem)"
  :item="stanza"></content-poem-stanza></div><div
  class="float-clear"></div></template></content-article></template><template
  v-slot:middle><content-stream item-type="e.instance"
  :get-more-items="getMoreInstances"
  grid-class="grid-1"></content-stream></template></site>
